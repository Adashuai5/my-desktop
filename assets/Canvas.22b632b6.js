import{R as _,b as B,r as u,j as m,F as ge,c as Q}from"./index.d4eb5d68.js";import{I as Z}from"./index.a754afbf.js";import{m as ee,F as Ae,D as Pe}from"./Footer.2fea16df.js";function se(){return se=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var f=arguments[i];for(var e in f)Object.prototype.hasOwnProperty.call(f,e)&&(r[e]=f[e])}return r},se.apply(this,arguments)}function he(r,i){if(r==null)return{};var f={},e=Object.keys(r),a,t;for(t=0;t<e.length;t++)a=e[t],!(i.indexOf(a)>=0)&&(f[a]=r[a]);return f}function ne(r,i){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},ne(r,i)}function Ce(r,i){r.prototype=Object.create(i.prototype),r.prototype.constructor=r,ne(r,i)}function we(r,i){return r.classList?!!i&&r.classList.contains(i):(" "+(r.className.baseVal||r.className)+" ").indexOf(" "+i+" ")!==-1}function Fe(r,i){r.classList?r.classList.add(i):we(r,i)||(typeof r.className=="string"?r.className=r.className+" "+i:r.setAttribute("class",(r.className&&r.className.baseVal||"")+" "+i))}function Ee(r,i){return r.replace(new RegExp("(^|\\s)"+i+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Ie(r,i){r.classList?r.classList.remove(i):typeof r.className=="string"?r.className=Ee(r.className,i):r.setAttribute("class",Ee(r.className&&r.className.baseVal||"",i))}var me={disabled:!1},be=_.createContext(null),ke=function(i){return i.scrollTop},w="unmounted",D="exited",O="entering",y="entered",ae="exiting",N=function(r){Ce(i,r);function i(e,a){var t;t=r.call(this,e,a)||this;var s=a,n=s&&!s.isMounting?e.enter:e.appear,l;return t.appearStatus=null,e.in?n?(l=D,t.appearStatus=O):l=y:e.unmountOnExit||e.mountOnEnter?l=w:l=D,t.state={status:l},t.nextCallback=null,t}i.getDerivedStateFromProps=function(a,t){var s=a.in;return s&&t.status===w?{status:D}:null};var f=i.prototype;return f.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},f.componentDidUpdate=function(a){var t=null;if(a!==this.props){var s=this.state.status;this.props.in?s!==O&&s!==y&&(t=O):(s===O||s===y)&&(t=ae)}this.updateStatus(!1,t)},f.componentWillUnmount=function(){this.cancelNextCallback()},f.getTimeouts=function(){var a=this.props.timeout,t,s,n;return t=s=n=a,a!=null&&typeof a!="number"&&(t=a.exit,s=a.enter,n=a.appear!==void 0?a.appear:s),{exit:t,enter:s,appear:n}},f.updateStatus=function(a,t){if(a===void 0&&(a=!1),t!==null)if(this.cancelNextCallback(),t===O){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:B.findDOMNode(this);s&&ke(s)}this.performEnter(a)}else this.performExit();else this.props.unmountOnExit&&this.state.status===D&&this.setState({status:w})},f.performEnter=function(a){var t=this,s=this.props.enter,n=this.context?this.context.isMounting:a,l=this.props.nodeRef?[n]:[B.findDOMNode(this),n],c=l[0],x=l[1],v=this.getTimeouts(),h=n?v.appear:v.enter;if(!a&&!s||me.disabled){this.safeSetState({status:y},function(){t.props.onEntered(c)});return}this.props.onEnter(c,x),this.safeSetState({status:O},function(){t.props.onEntering(c,x),t.onTransitionEnd(h,function(){t.safeSetState({status:y},function(){t.props.onEntered(c,x)})})})},f.performExit=function(){var a=this,t=this.props.exit,s=this.getTimeouts(),n=this.props.nodeRef?void 0:B.findDOMNode(this);if(!t||me.disabled){this.safeSetState({status:D},function(){a.props.onExited(n)});return}this.props.onExit(n),this.safeSetState({status:ae},function(){a.props.onExiting(n),a.onTransitionEnd(s.exit,function(){a.safeSetState({status:D},function(){a.props.onExited(n)})})})},f.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},f.safeSetState=function(a,t){t=this.setNextCallback(t),this.setState(a,t)},f.setNextCallback=function(a){var t=this,s=!0;return this.nextCallback=function(n){s&&(s=!1,t.nextCallback=null,a(n))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},f.onTransitionEnd=function(a,t){this.setNextCallback(t);var s=this.props.nodeRef?this.props.nodeRef.current:B.findDOMNode(this),n=a==null&&!this.props.addEndListener;if(!s||n){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],c=l[0],x=l[1];this.props.addEndListener(c,x)}a!=null&&setTimeout(this.nextCallback,a)},f.render=function(){var a=this.state.status;if(a===w)return null;var t=this.props,s=t.children;t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef;var n=he(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return _.createElement(be.Provider,{value:null},typeof s=="function"?s(a,n):_.cloneElement(_.Children.only(s),n))},i}(_.Component);N.contextType=be;N.propTypes={};function L(){}N.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:L,onEntering:L,onEntered:L,onExit:L,onExiting:L,onExited:L};N.UNMOUNTED=w;N.EXITED=D;N.ENTERING=O;N.ENTERED=y;N.EXITING=ae;var $e=N,Me=function(i,f){return i&&f&&f.split(" ").forEach(function(e){return Fe(i,e)})},te=function(i,f){return i&&f&&f.split(" ").forEach(function(e){return Ie(i,e)})},re=function(r){Ce(i,r);function i(){for(var e,a=arguments.length,t=new Array(a),s=0;s<a;s++)t[s]=arguments[s];return e=r.call.apply(r,[this].concat(t))||this,e.appliedClasses={appear:{},enter:{},exit:{}},e.onEnter=function(n,l){var c=e.resolveArguments(n,l),x=c[0],v=c[1];e.removeClasses(x,"exit"),e.addClass(x,v?"appear":"enter","base"),e.props.onEnter&&e.props.onEnter(n,l)},e.onEntering=function(n,l){var c=e.resolveArguments(n,l),x=c[0],v=c[1],h=v?"appear":"enter";e.addClass(x,h,"active"),e.props.onEntering&&e.props.onEntering(n,l)},e.onEntered=function(n,l){var c=e.resolveArguments(n,l),x=c[0],v=c[1],h=v?"appear":"enter";e.removeClasses(x,h),e.addClass(x,h,"done"),e.props.onEntered&&e.props.onEntered(n,l)},e.onExit=function(n){var l=e.resolveArguments(n),c=l[0];e.removeClasses(c,"appear"),e.removeClasses(c,"enter"),e.addClass(c,"exit","base"),e.props.onExit&&e.props.onExit(n)},e.onExiting=function(n){var l=e.resolveArguments(n),c=l[0];e.addClass(c,"exit","active"),e.props.onExiting&&e.props.onExiting(n)},e.onExited=function(n){var l=e.resolveArguments(n),c=l[0];e.removeClasses(c,"exit"),e.addClass(c,"exit","done"),e.props.onExited&&e.props.onExited(n)},e.resolveArguments=function(n,l){return e.props.nodeRef?[e.props.nodeRef.current,n]:[n,l]},e.getClassNames=function(n){var l=e.props.classNames,c=typeof l=="string",x=c&&l?l+"-":"",v=c?""+x+n:l[n],h=c?v+"-active":l[n+"Active"],b=c?v+"-done":l[n+"Done"];return{baseClassName:v,activeClassName:h,doneClassName:b}},e}var f=i.prototype;return f.addClass=function(a,t,s){var n=this.getClassNames(t)[s+"ClassName"],l=this.getClassNames("enter"),c=l.doneClassName;t==="appear"&&s==="done"&&c&&(n+=" "+c),s==="active"&&a&&ke(a),n&&(this.appliedClasses[t][s]=n,Me(a,n))},f.removeClasses=function(a,t){var s=this.appliedClasses[t],n=s.base,l=s.active,c=s.done;this.appliedClasses[t]={},n&&te(a,n),l&&te(a,l),c&&te(a,c)},f.render=function(){var a=this.props;a.classNames;var t=he(a,["classNames"]);return _.createElement($e,se({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},i}(_.Component);re.defaultProps={classNames:""};re.propTypes={};var Be=re;const je=()=>{const[r,i]=u.exports.useState(!1);return{openDialog:()=>i(!0),closeDialog:()=>i(!1),RenderDialog:({width:t,height:s,id:n,title:l,message:c,imgSrc:x,onCheck:v,onClose:h})=>{const b=u.exports.useMemo(()=>({width:t,height:s,left:`calc(50vw - ${t/2}px)`,top:`calc(50vh - ${s}px)`,borderRadius:4}),[t,s]),F=()=>{if(!!x)return m("img",{src:x,width:"52",height:"52",alt:"tip"})};return m(ge,{children:r&&m("div",{id:n,style:b,children:m(ee.Dialog,{title:l,message:c,icon:F(),buttons:[m(ee.Button,{onClick:h,children:"\u53D6\u6D88"}),m(ee.Button,{color:"blue",onClick:v,children:"\u786E\u8BA4"})]})})})}}},Ue=({width:r,height:i,onRef:f})=>{const e=["black","red","green","blue"],a=["canvas_save","canvas_clear","turn_left_flat","turn_right_flat"],t=["canvas_paint","canvas_eraser"],s=u.exports.useRef(null),n=u.exports.useRef(null),l=u.exports.useRef(null),[c,x]=u.exports.useState("black"),[v,h]=u.exports.useState(5),[b,F]=u.exports.useState(!1),[oe,j]=u.exports.useState(!1),[U,I]=u.exports.useState(void 0),[C,W]=u.exports.useState(-1),[S,ie]=u.exports.useState([]),le=o=>{if(!!s.current)return{x:o.offsetX,y:o.offsetY}},ce=u.exports.useCallback(()=>{if(W(C+1),!s.current)return;const o=s.current;if(S.push(o.toDataURL()),ie(S),!n.current||!l.current)return;const p=n.current,E=l.current;p.classList.add("active"),E.classList.remove("active")},[C,S]),G=u.exports.useCallback(o=>{const p=le(o);p&&(I(p),j(!0))},[]),ue=u.exports.useCallback((o,p)=>{if(!s.current)return;const d=s.current.getContext("2d");d&&(d.strokeStyle=c,d.lineJoin="round",d.lineWidth=v,d.beginPath(),d.moveTo(o.x,o.y),d.lineTo(p.x,p.y),d.closePath(),d.stroke())},[v,c]),$=u.exports.useCallback(({x:o,y:p,width:E,height:d})=>{if(!s.current)return;const k=s.current.getContext("2d");k&&k.clearRect(o,p,E,d)},[]),z=u.exports.useCallback(o=>{if(oe){const p=le(o);U&&p&&(b?$({x:p.x-v/2,y:p.y-v/2,width:v,height:v}):(ue(U,p),I(p)))}},[oe,b,U,v,ue,$]),H=u.exports.useCallback(()=>{j(!1),I(void 0),ce()},[ce]),V=u.exports.useCallback(()=>{j(!1),I(void 0)},[]);u.exports.useEffect(()=>{if(!s.current)return;const o=s.current;return o.addEventListener("mousedown",G),o.addEventListener("mousemove",z),o.addEventListener("mouseup",H),o.addEventListener("mouseleave",V),()=>{o.removeEventListener("mousedown",G),o.removeEventListener("mousemove",z),o.removeEventListener("mouseup",H),o.removeEventListener("mouseleave",V)}},[G,z,H,V]);const[R,Ne]=u.exports.useState(!0),Se=u.exports.useCallback(()=>{Ne(!R)},[R]),De=u.exports.useCallback((o,p)=>{const E=o.currentTarget;E.classList[1]||(F(p==="canvas_eraser"),E.classList.add("active"),E.parentNode.childNodes.forEach(d=>{!d.matches("svg")||d===E||d.classList.remove("active")}))},[]),Oe=u.exports.useCallback(o=>{h(o.target.value)},[]),_e=u.exports.useCallback(([o,p,E])=>{const d=o.target;d.className.includes("active")||(x(E),d.classList.add("active"),d.parentNode.childNodes.forEach(g=>{!g.matches(p)||g===d||g.classList.remove("active")}))},[]),Te=u.exports.useCallback(o=>{x(o.target.value)},[]),{openDialog:pe,closeDialog:fe,RenderDialog:Le}=je(),[A,M]=u.exports.useState(!1),[T,P]=u.exports.useState(!1);u.exports.useImperativeHandle(f,()=>({drawingCloseClick:()=>{if(C===-1)J({...X,type:!1});else if(A)return;P(!0)}})),u.exports.useEffect(()=>{T?A||(xe({title:"\u9000\u51FA\u5C06\u4E22\u5931\u8BE5\u753B\u5E03\uFF01",message:"\u786E\u8BA4\u9000\u51FA\u753B\u677F\uFF1F"}),M(!0)):xe({title:"\u60A8\u786E\u5B9A\u8981\u6E05\u7A7A\u8BE5\u753B\u5E03\u5417\uFF1F",message:"\u4E00\u65E6\u6E05\u7A7A\u5C06\u65E0\u6CD5\u64A4\u56DE\u3002"})},[T,A]);const[X,J]=u.exports.useContext(Ae);u.exports.useEffect(()=>A?pe():fe(),[fe,A,pe]);const de=u.exports.useCallback(()=>{if(!s.current)return;const o=s.current,p=o.getContext("2d");if(p){const E=p.globalCompositeOperation;p.globalCompositeOperation="destination-over",p.fillStyle="#fff",p.fillRect(0,0,r,i);const d=o.toDataURL("image/png");p.putImageData(p.getImageData(0,0,r,i),0,0),p.globalCompositeOperation=E;const g=document.createElement("a");document.body.appendChild(g),g.href=d,g.download="myPaint",g.target="_blank",g.click()}},[r,i]),K=u.exports.useCallback(o=>{if(!s.current||!n.current||!l.current)return;const E=s.current.getContext("2d"),d=n.current,g=l.current;if(E){let k=-1;if(o==="back"&&C>=0)k=C-1,g.classList.add("active"),k<0&&d.classList.remove("active");else if(o==="go"&&C<S.length-1)k=C+1,d.classList.add("active"),k===S.length-1&&g.classList.remove("active");else return;E.clearRect(0,0,r,i);const q=new Image;q.src=S[k],q.addEventListener("load",()=>{E.drawImage(q,0,0)}),W(k)}},[S,C,r,i]),ye=u.exports.useCallback(o=>{switch(o){case"canvas_clear":if(C===-1)return;M(!0);break;case"canvas_save":de();break;case"turn_left_flat":K("back");break;case"turn_right_flat":K("go");break}},[de,K,C]),[ve,xe]=u.exports.useState({title:"\u60A8\u786E\u5B9A\u8981\u6E05\u7A7A\u8BE5\u753B\u5E03\u5417\uFF1F",message:"\u4E00\u65E6\u6E05\u7A7A\u5C06\u65E0\u6CD5\u64A4\u56DE\u3002"}),Y=u.exports.useCallback(()=>{M(!1),T&&P(!1)},[M,T,P]),Re=u.exports.useCallback(()=>{if($({x:0,y:0,width:r,height:i}),ie([]),W(-1),Y(),!n.current||!l.current)return;const o=n.current,p=l.current;o.classList.remove("active"),p.classList.remove("active"),T&&(J({...X,type:!1}),P(!1))},[Y,$,r,i,T,P,X,J]);return Q(ge,{children:[m("canvas",{id:"canvas",ref:s,height:i,width:r}),m("div",{id:"toolbox-open",style:{borderRadius:R?null:5},children:m(Z,{type:R?"icon-upward_flat":"icon-downward_flat",style:{width:"100%",fontSize:32},clickEvent:Se})}),m(Be,{in:R,timeout:300,classNames:"toolbox",unmountOnExit:!0,children:Q("div",{id:"toolbox",children:[m("span",{children:"Options"}),m("div",{className:"options",children:a.map((o,p)=>m(Z,{svgRef:o==="turn_right_flat"?l:o==="turn_left_flat"?n:void 0,className:o,type:"icon-"+o,style:{fontSize:50},clickEvent:()=>ye(o)},p+o))}),m("span",{children:"Toolbox"}),m("div",{className:"tools",children:t.map((o,p)=>m(Z,{className:o==="canvas_eraser"?b?"active":"":b?"":"active",type:"icon-"+o,style:{fontSize:50},clickEvent:E=>De(E,o)},p+o))}),m("div",{className:"sizes",children:m("input",{style:{backgroundColor:b?"#ebeff4":c},type:"range",id:"range",name:"range",min:"1",max:"20",value:v,onChange:Oe})}),Q("ol",{className:"colors",children:[e.map((o,p)=>m("li",{className:o===c?o+" active":o,onClick:E=>_e([E,"li",o])},p+o)),m("input",{type:"color",value:c,onChange:Te,id:"currentColor"})]})]})}),m(Le,{width:300,height:120,id:"clear-dialog",title:ve.title,message:ve.message,imgSrc:Pe,onCheck:Re,onClose:Y})]})};Ue.defaultProps={width:window.innerWidth,height:window.innerHeight};export{Ue as default};
